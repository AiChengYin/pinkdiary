# APK 签名说明

## 当前已解决
✅ **Debug APK 已生成**：`android/app/build/outputs/apk/debug/app-debug.apk`
- 此 APK 已自动使用 debug keystore 签名
- 可以直接安装到设备上测试
- **路径**：`b:\code\pinkdiary\android\app\build\outputs\apk\debug\app-debug.apk`

## 使用 Debug APK 测试
1. 将 `app-debug.apk` 传输到您的 Android 设备
2. 在设备上允许"安装未知来源的应用"
3. 点击 APK 文件进行安装
4. 测试定位功能，确认不再闪退

---

## 方案 2：生成正式签名的 Release APK（用于发布）

如果您需要发布到应用商店或正式分发，需要创建 release keystore：

### 步骤 1：生成 Release Keystore

在 PowerShell 中运行（在 `android/app` 目录下）：

```powershell
keytool -genkeypair -v -storetype PKCS12 -keystore pinkdiary-release.keystore -alias pinkdiary -keyalg RSA -keysize 2048 -validity 10000
```

会提示输入：
- Keystore 密码（请记住！）
- 您的名字和组织信息
- Key 密码（可以与 keystore 密码相同）

### 步骤 2：配置签名

创建 `android/keystore.properties` 文件：

```properties
storePassword=你的keystore密码
keyPassword=你的key密码
keyAlias=pinkdiary
storeFile=app/pinkdiary-release.keystore
```

### 步骤 3：修改 build.gradle

在 `android/app/build.gradle` 的 `android` 块中添加：

```gradle
def keystorePropertiesFile = rootProject.file("keystore.properties")
def keystoreProperties = new Properties()
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
}

android {
    // ... 现有配置 ...
    
    signingConfigs {
        release {
            if (keystorePropertiesFile.exists()) {
                keyAlias keystoreProperties['keyAlias']
                keyPassword keystoreProperties['keyPassword']
                storeFile file(keystoreProperties['storeFile'])
                storePassword keystoreProperties['storePassword']
            }
        }
    }
    
    buildTypes {
        release {
            signingConfig signingConfigs.release  // 添加这行
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}
```

### 步骤 4：生成签名的 Release APK

```powershell
cd android
.\gradlew assembleRelease
```

生成的 APK 位置：`android/app/build/outputs/apk/release/app-release.apk`

---

## 安全提示
⚠️ **重要**：
1. 永远不要将 `keystore.properties` 和 `.keystore` 文件提交到 Git
2. 将它们添加到 `.gitignore`
3. 妥善保管 keystore 文件和密码（丢失后无法更新应用）
4. keystore 文件建议备份到安全位置

---

## 快速命令参考

```powershell
# 生成 Debug APK（已签名，可直接安装）
cd android
.\gradlew assembleDebug

# 生成 Release APK（需要配置签名）
cd android
.\gradlew assembleRelease

# 清理构建
cd android
.\gradlew clean

# 查看构建配置
cd android
.\gradlew signingReport
```
